{% extends "base.html" %}

{% block title %}Modifier {{ payment.name }} - Budgee Family{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-edit"></i> Modifier {{ payment.name }}</h2>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <h5 class="mb-3"><i class="fas fa-shopping-cart"></i> Informations du produit/service</h5>

                        <div class="mb-3">
                            <label for="name" class="form-label">Nom de l'article <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" required
                                   value="{{ payment.name }}">
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="2">{{ payment.description or '' }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="merchant" class="form-label">Marchand</label>
                                <input type="text" class="form-control" id="merchant" name="merchant"
                                       value="{{ payment.merchant or '' }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="provider" class="form-label">Fournisseur de paiement</label>
                                <select class="form-select" id="provider" name="provider">
                                    <option value="">Sélectionner...</option>
                                    <option value="ALMA" {% if payment.provider == 'ALMA' %}selected{% endif %}>ALMA</option>
                                    <option value="Amazon" {% if payment.provider == 'Amazon' %}selected{% endif %}>Amazon</option>
                                    <option value="Cetelem" {% if payment.provider == 'Cetelem' %}selected{% endif %}>Cetelem</option>
                                    <option value="Klarna" {% if payment.provider == 'Klarna' %}selected{% endif %}>Klarna</option>
                                    <option value="Oney" {% if payment.provider == 'Oney' %}selected{% endif %}>Oney</option>
                                    <option value="PayPal" {% if payment.provider == 'PayPal' %}selected{% endif %}>PayPal</option>
                                    <option value="Autre" {% if payment.provider == 'Autre' %}selected{% endif %}>Autre</option>
                                </select>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h5 class="mb-3"><i class="fas fa-tags"></i> Catégorisation</h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="product_category" class="form-label">Catégorie de produit</label>
                                <select class="form-select" id="product_category" name="product_category">
                                    <option value="">Sélectionner...</option>
                                    <option value="Alimentation" {% if payment.product_category == 'Alimentation' %}selected{% endif %}>Alimentation</option>
                                    <option value="Autre" {% if payment.product_category == 'Autre' %}selected{% endif %}>Autre</option>
                                    <option value="Automobile" {% if payment.product_category == 'Automobile' %}selected{% endif %}>Automobile</option>
                                    <option value="Beauté & Santé" {% if payment.product_category == 'Beauté & Santé' %}selected{% endif %}>Beauté & Santé</option>
                                    <option value="Électroménager" {% if payment.product_category == 'Électroménager' %}selected{% endif %}>Électroménager</option>
                                    <option value="Équipement de la maison" {% if payment.product_category == 'Équipement de la maison' %}selected{% endif %}>Équipement de la maison</option>
                                    <option value="Études" {% if payment.product_category == 'Études' %}selected{% endif %}>Études</option>
                                    <option value="Gaming" {% if payment.product_category == 'Gaming' %}selected{% endif %}>Gaming</option>
                                    <option value="Informatique" {% if payment.product_category == 'Informatique' %}selected{% endif %}>Informatique</option>
                                    <option value="Mobile" {% if payment.product_category == 'Mobile' %}selected{% endif %}>Mobile</option>
                                    <option value="Mode" {% if payment.product_category == 'Mode' %}selected{% endif %}>Mode</option>
                                    <option value="Sport" {% if payment.product_category == 'Sport' %}selected{% endif %}>Sport</option>
                                    <option value="TV Son Hifi" {% if payment.product_category == 'TV Son Hifi' %}selected{% endif %}>TV Son Hifi</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="credit_type_id" class="form-label">Type de crédit</label>
                                <select class="form-select" id="credit_type_id" name="credit_type_id">
                                    <option value="">Aucun</option>
                                    {% for type in credit_types %}
                                        <option value="{{ type.id }}" {% if payment.credit_type_id == type.id %}selected{% endif %}>
                                            {{ type.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="alert alert-warning">
                            <i class="fas fa-info-circle"></i>
                            <strong>Note :</strong> Les montants et les dates ne peuvent pas être modifiés après création.
                        </div>

                        <div class="d-flex gap-2 justify-content-end mt-4">
                            <a href="{{ url_for('installments.detail', payment_id=payment.id) }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Annuler
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fas fa-euro-sign"></i> Informations (non modifiables)</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted">Montant total</small><br>
                        <strong class="h5">{{ payment.total_amount | format_amount }} {{ payment.currency | currency_symbol }}</strong>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted">Mensualité</small><br>
                        <strong class="h5 text-warning">{{ payment.installment_amount | format_amount }} {{ payment.currency | currency_symbol }}</strong>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted">Nombre de mensualités</small><br>
                        <strong>{{ payment.number_of_installments }} fois</strong>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted">Progression</small><br>
                        <strong>{{ payment.installments_paid }} / {{ payment.number_of_installments }} payées</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
