{% extends "base.html" %}

{% block title %}Modifier {{ bank.name }} - Administration{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-university"></i> Modifier {{ bank.name }}</h2>
                <a href="{{ url_for('admin.default_banks_list') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
            </div>

            <div class="card">
                <div class="card-body p-4">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Nom de la banque *</label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           value="{{ bank.name }}" placeholder="ex: BNP Paribas">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="country_code" class="form-label">Pays *</label>
                                    <input type="text" class="form-control" id="country_code" name="country_code" required
                                           value="{{ bank.country_code }}" placeholder="ex: FR" maxlength="2" pattern="[A-Z]{2}">
                                    <small class="text-muted">Code ISO</small>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="language" class="form-label">Langue *</label>
                                    <input type="text" class="form-control" id="language" name="language" required
                                           value="{{ bank.language }}" placeholder="ex: fr" maxlength="2" pattern="[a-z]{2}">
                                    <small class="text-muted">Code</small>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="bic" class="form-label">Code BIC/SWIFT</label>
                            <input type="text" class="form-control" id="bic" name="bic"
                                   value="{{ bank.bic or '' }}" placeholder="ex: AGRIFRPP" maxlength="11">
                        </div>

                        <hr class="my-4">
                        <h5 class="mb-3"><i class="fas fa-palette"></i> Apparence</h5>

                        {% if bank.logo_data %}
                        <div class="mb-3">
                            <label class="form-label">Logo actuel</label>
                            <div class="d-flex align-items-center gap-3">
                                <img src="data:{{ bank.logo_mime_type }};base64,{{ bank.logo_data }}" alt="{{ bank.name }}"
                                     style="width: 80px; height: 80px; object-fit: contain; border: 1px solid #ddd; padding: 5px; border-radius: 5px;">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="remove_logo" name="remove_logo" value="1">
                                    <label class="form-check-label text-danger" for="remove_logo">
                                        <i class="fas fa-trash"></i> Supprimer le logo
                                    </label>
                                </div>
                            </div>
                        </div>
                        {% elif bank.color and bank.initials %}
                        <div class="mb-3">
                            <label class="form-label">Logo actuel (généré)</label>
                            <div>
                                <svg width="80" height="80" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="80" height="80" rx="8" fill="{{ bank.color }}"/>
                                    <text x="40" y="52" font-family="Arial, sans-serif" font-size="26" font-weight="bold"
                                          fill="{{ bank.text_color or '#FFFFFF' }}" text-anchor="middle">{{ bank.initials }}</text>
                                </svg>
                            </div>
                        </div>
                        {% endif %}

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="initials" class="form-label">Initiales (pour logo généré)</label>
                                    <input type="text" class="form-control" id="initials" name="initials"
                                           value="{{ bank.initials or '' }}" placeholder="ex: BNP" maxlength="10">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="color" class="form-label">Couleur</label>
                                    <input type="color" class="form-control form-control-color" id="color" name="color"
                                           value="{{ bank.color or '#6366f1' }}">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="text_color" class="form-label">Couleur du texte</label>
                                    <input type="color" class="form-control form-control-color" id="text_color" name="text_color"
                                           value="{{ bank.text_color or '#FFFFFF' }}">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="logo" class="form-label">Nouveau logo (optionnel)</label>
                            <input type="file" class="form-control" id="logo" name="logo"
                                   accept="image/png,image/jpeg,image/jpg,image/gif,image/webp">
                            <small class="text-muted">Format: PNG, JPG, GIF, WebP (max 2 Mo). Laissez vide pour conserver le logo actuel.</small>
                        </div>

                        <hr class="my-4">
                        <h5 class="mb-3"><i class="fas fa-map-marker-alt"></i> Coordonnées</h5>

                        <div class="mb-3">
                            <label for="address" class="form-label">Adresse</label>
                            <textarea class="form-control" id="address" name="address" rows="2"
                                      placeholder="Adresse du siège social">{{ bank.address or '' }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="postal_code" class="form-label">Code postal</label>
                                    <input type="text" class="form-control" id="postal_code" name="postal_code"
                                           value="{{ bank.postal_code or '' }}" placeholder="ex: 75001">
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="city" class="form-label">Ville</label>
                                    <input type="text" class="form-control" id="city" name="city"
                                           value="{{ bank.city or '' }}" placeholder="ex: Paris">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Téléphone</label>
                                    <input type="tel" class="form-control" id="phone" name="phone"
                                           value="{{ bank.phone or '' }}" placeholder="ex: 01 23 45 67 89">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" name="email"
                                           value="{{ bank.email or '' }}" placeholder="contact@banque.fr">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="website" class="form-label">Site web</label>
                            <input type="url" class="form-control" id="website" name="website"
                                   value="{{ bank.website or '' }}" placeholder="https://www.banque.fr">
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Enregistrer les modifications
                            </button>
                            <a href="{{ url_for('admin.default_banks_list') }}" class="btn btn-outline-secondary">
                                Annuler
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Convertir les codes pays et langue en majuscules/minuscules
    const countryInput = document.getElementById('country_code');
    countryInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase();
    });

    const languageInput = document.getElementById('language');
    languageInput.addEventListener('input', function() {
        this.value = this.value.toLowerCase();
    });
});
</script>
{% endblock %}
